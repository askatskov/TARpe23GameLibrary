{
  "openapi": "3.0.0",
  "info": {
    "title": "Game Marketplace API",
    "version": "1.0.0",
    "description": "RAWG-based game marketplace for Buy/Sell of keys/accounts."
  },
  "servers": [
    {
      "url": "http://localhost:8000/api/v1"
    }
  ],
  "paths": {
    "/games/search": {
      "get": {
        "tags": ["Games"],
        "summary": "Search games from RAWG",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": true,
            "schema": { "type": "string" },
            "description": "Search query (game name)"
          },
          {
            "name": "page",
            "in": "query",
            "schema": { "type": "integer", "default": 1 }
          },
          {
            "name": "pageSize",
            "in": "query",
            "schema": { "type": "integer", "default": 20 }
          }
        ],
        "responses": {
          "200": {
            "description": "RAWG search result",
            "content": { "application/json": {} }
          }
        }
      }
    },

    "/games/{id}": {
      "get": {
        "tags": ["Games"],
        "summary": "Get game details from RAWG",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "RAWG game ID or slug"
          }
        ],
        "responses": {
          "200": {
            "description": "Game details",
            "content": { "application/json": {} }
          }
        }
      }
    },

    "/listings": {
      "get": {
        "tags": ["Listings"],
        "summary": "Get listings (filterable)",
        "parameters": [
          {
            "name": "type",
            "in": "query",
            "schema": { "type": "string", "enum": ["BUY", "SELL"] }
          },
          {
            "name": "itemType",
            "in": "query",
            "schema": { "type": "string", "enum": ["KEY", "ACCOUNT"] }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["ACTIVE", "SOLD", "EXPIRED", "CANCELLED"]
            }
          },
          {
            "name": "gameRawgId",
            "in": "query",
            "schema": { "type": "integer" }
          },
          {
            "name": "platform",
            "in": "query",
            "schema": { "type": "string" }
          },
          {
            "name": "userId",
            "in": "query",
            "schema": { "type": "integer" }
          },
          {
            "name": "minPrice",
            "in": "query",
            "schema": { "type": "number" }
          },
          {
            "name": "maxPrice",
            "in": "query",
            "schema": { "type": "number" }
          }
        ],
        "responses": {
          "200": {
            "description": "List of listings",
            "content": {
              "application/json": {
                "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Listing" } }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Listings"],
        "summary": "Create listing (Buy or Sell)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ListingCreate" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Listing created",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Listing" }
              }
            }
          }
        }
      }
    },

    "/listings/{id}": {
      "get": {
        "tags": ["Listings"],
        "summary": "Get listing by id",
        "parameters": [
          { "$ref": "#/components/parameters/ListingId" }
        ],
        "responses": {
          "200": {
            "description": "Listing",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Listing" }
              }
            }
          },
          "404": { "description": "Listing not found" }
        }
      },
      "put": {
        "tags": ["Listings"],
        "summary": "Update listing",
        "parameters": [
          { "$ref": "#/components/parameters/ListingId" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ListingUpdate" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Listing updated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Listing" }
              }
            }
          },
          "404": { "description": "Listing not found" }
        }
      },
      "delete": {
        "tags": ["Listings"],
        "summary": "Delete listing",
        "parameters": [
          { "$ref": "#/components/parameters/ListingId" }
        ],
        "responses": {
          "204": { "description": "Deleted" },
          "404": { "description": "Listing not found" }
        }
      }
    }
  },

  "components": {
    "parameters": {
      "ListingId": {
        "name": "id",
        "in": "path",
        "required": true,
        "schema": { "type": "integer" }
      }
    },
    "schemas": {
      "Listing": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "gameRawgId": { "type": "integer" },
          "gameSlug": { "type": "string" },
          "gameName": { "type": "string" },
          "type": { "type": "string", "enum": ["BUY", "SELL"] },
          "itemType": { "type": "string", "enum": ["KEY", "ACCOUNT"] },
          "platform": { "type": "string" },
          "price": { "type": "number" },
          "currency": { "type": "string" },
          "description": { "type": "string" },
          "userId": { "type": "integer" },
          "status": {
            "type": "string",
            "enum": ["ACTIVE", "SOLD", "EXPIRED", "CANCELLED"]
          },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        }
      },
      "ListingCreate": {
        "type": "object",
        "required": ["gameRawgId", "gameName", "type", "itemType", "price"],
        "properties": {
          "gameRawgId": { "type": "integer" },
          "gameSlug": { "type": "string" },
          "gameName": { "type": "string" },
          "type": { "type": "string", "enum": ["BUY", "SELL"] },
          "itemType": { "type": "string", "enum": ["KEY", "ACCOUNT"] },
          "platform": { "type": "string" },
          "price": { "type": "number" },
          "currency": { "type": "string", "default": "EUR" },
          "description": { "type": "string" },
          "userId": { "type": "integer" }
        }
      },
      "ListingUpdate": {
        "type": "object",
        "properties": {
          "gameSlug": { "type": "string" },
          "gameName": { "type": "string" },
          "type": { "type": "string", "enum": ["BUY", "SELL"] },
          "itemType": { "type": "string", "enum": ["KEY", "ACCOUNT"] },
          "platform": { "type": "string" },
          "price": { "type": "number" },
          "currency": { "type": "string" },
          "description": { "type": "string" },
          "userId": { "type": "integer" },
          "status": {
            "type": "string",
            "enum": ["ACTIVE", "SOLD", "EXPIRED", "CANCELLED"]
          }
        }
      }
    }
  }
}
